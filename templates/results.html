{% extends "base.html" %}

{% block content %}
<div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="border-b border-gray-800 sticky top-0 bg-dark-bg z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center gap-4">
                <a href="/" class="text-xl font-bold text-blue-500">Nova Lite</a>
                <form action="{{ url_for('search') }}" method="get" class="flex-1 max-w-3xl">
                    <div class="flex gap-2">
                        <div class="flex-1 relative">
                            <input type="text" name="q" value="{{ query }}"
                                   class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <select name="type" class="bg-gray-700 text-white rounded-lg px-3">
                            <option value="" {% if not selected_type %}selected{% endif %}>All</option>
                            <option value="pdf" {% if selected_type == 'pdf' %}selected{% endif %}>PDF</option>
                            <option value="doc" {% if selected_type == 'doc' %}selected{% endif %}>Doc</option>
                            <option value="code" {% if selected_type == 'code' %}selected{% endif %}>Code</option>
                            <option value="data" {% if selected_type == 'data' %}selected{% endif %}>Data</option>
                        </select>
                        <button type="submit" class="bg-blue-600 text-white rounded-lg px-6 hover:bg-blue-700">
                            Search
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 max-w-7xl mx-auto px-4 py-6">
        {% if ai_response %}
        <div class="mb-8 bg-gray-800/50 rounded-xl p-6">
            <h2 class="text-xl font-semibold mb-4 text-blue-400">AI Analysis</h2>
            <div class="prose prose-invert max-w-none">
                {{ ai_response | safe }}
            </div>
        </div>
        {% endif %}

        {% for file_type, results in grouped_results.items() %}
        <section class="mb-8">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                {{ file_type }} Results ({{ results|length }})
            </h3>
            <div class="space-y-4">
                {% for result in results %}
                <article class="bg-gray-800/30 rounded-xl p-6 hover:bg-gray-800/50 transition">
                    <div class="flex items-start gap-4">
                        <div class="flex-1">
                            <h4>
                                <a href="{{ result.link }}" class="text-blue-400 hover:underline text-xl">
                                    {{ result.title }}
                                </a>
                            </h4>
                            <p class="text-gray-400 text-sm mb-2">{{ result.link }}</p>
                            <p class="text-gray-300">{{ result.snippet }}</p>
                            {% if result.content %}
                            <div class="mt-3 text-sm text-gray-400">
                                {{ result.content[:200] }}...
                            </div>
                            {% endif %}
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm bg-blue-900/50 text-blue-300">
                            {{ result.file_type }}
                        </span>
                    </div>
                </article>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
    </main>
</div>
{% endblock %}
